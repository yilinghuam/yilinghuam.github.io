<html>
    <head>
        <%- include('../partials/mapbox') %>
        <%- include('../partials/generic_head') %> 
        <%- include('../partials/common_styling') %>
        <%- include('../partials/mapbox_geocoder_styling') %>
        
    </head>
    <body>
        <%- include('../partials/navbar') %>

        <div class = 'container'>
        <div id="geocoder" class="geocoder row mt-5"></div>

        <div class = 'row mt-3 justify-content-center align-items-center'>
            <div class = 'col-6'>
                <form action="/eats" method="POST">
                    <div class="mb-3">
                        <input type="text" class="form-control" id="placeNameAndAddress" name = 'placeNameAndAddress' value= '<%= singleEat.placeName + ',' + singleEat.address%>' readonly>
                    </div>

                    <div class="mb-3">
                        <input type="hidden" class="form-control" id="coordinates" name = 'coordinates' value= '<%=singleEat.coordinates%>'>
                    </div>

                    <div class="mb-3">
                        <input type="text" class="form-control" autocomplete = 'on' list="mrtStations" id="mrt" name = 'mrt' placeholder="nearest MRT" value = '<%=singleEat.mrt%>'>
                        <datalist id="mrtStations">
                            <% mrtStations.forEach(station => { %>
                                <option value= '<%=station%>' >
                            <%}); %>
                        </datalist>
                    </div>

                    <div class = 'mb-3 row justify-content-center align-items-center'>
                        <div class = 'col-4'>
                            <select class="form-control tags" id = 'ratings' name = 'ratings'>
                                <% let ratingKey = Object.keys(ratings)%>
                                <% for (let i = 0; i < ratingKey.length ; i++) { %>
                                    <% if (singleEat.ratings === Number(ratingKey[i])) { %>
                                        <option selected value = <%=ratingKey[i]%>>
                                            <%- ratings[ratingKey[i]]%>
                                        </option>
                                    <% }else{ %>
                                    <option value=<%= ratingKey[i]%>>
                                        <%- ratings[ratingKey[i]] %>
                                    </option>
                                    <% } %>
                                <% } %>
                            </select>
                        </div>

                        <div class = 'col-4'>
                            <select class="form-control tags" name = 'price'>
                                <% let priceKey = Object.keys(price)%>

                                <% for (let i = 0; i < priceKey.length ; i++) { %>
                                    <% if (singleEat.price === Number(priceKey[i])) { %>
                                        <option selected value=<%= priceKey[i]%>>
                                            <%- price[priceKey[i]] %>
                                        </option>
                                    <% }else{ %>
                                        <option value=<%= priceKey[i]%>>
                                            <%- price[priceKey[i]] %>
                                        </option>
                                    <% } %>
                                <% } %>
                                                
                            </select>
                        </div>

                        <div class = 'col-4'>
                            <select class="form-control tags" name ='tags' id ='tags' >
                                <% category.forEach(element => { %>
                                    <% if (element === singleEat.element) {%>
                                        <option selected = '<%=element%>'>
                                            <%= element %>
                                        </option>
                                    <% }else { %>
                                        <option value="<%=element%>">
                                            <%=element%>
                                        </option>
                                    <% } %>
                                <% }); %>
                               
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <textarea class="form-control text-start" id="comments" rows="3" name='comments' placeholder="Comments"><%= singleEat.comments%></textarea>
                    </div>

                    <div class = 'mb-3 text-end'>
                            <button type="submit" class="btn btn-primary">SUBMIT</button>
                    </div>
                </form>
            </div>
        </div>
        </div>

        <script>
            mapboxgl.accessToken = <%- JSON.stringify(mapAccessToken) %> ;

            var geocoder = new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                countries: 'sg',
            });
            
            document.getElementById('geocoder').appendChild(geocoder.onAdd());

            // retrieve geocode results
                geocoder.on('result', function({ result }) { 
                document.getElementById('coordinates').value = result.geometry.coordinates;
                document.getElementById('placeNameAndAddress').value = result.place_name;
                // centre or geometry coordinates?
                console.log(typeof document.getElementById('coordinates').value)
                console.log(result)
            })
            
        </script>
    </body>
</html>